{
    "sourceFile": "app/admin/views.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 11,
            "patches": [
                {
                    "date": 1634868669176,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1634870755265,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,12 +2,13 @@\n \r\n from flask import abort, flash, redirect, render_template, url_for\r\n from flask_login import current_user, login_required\r\n \r\n+\r\n from . import admin\r\n-from forms import DepartmentForm\r\n+from forms import DepartmentForm, EmployeeAssignForm, RoleForm\r\n from .. import db\r\n-from ..models import Department\r\n+from ..models import Department, Employee, Role\r\n \r\n def check_admin():\r\n     \"\"\"\r\n     Prevent non-admins from accessing the page\r\n"
                },
                {
                    "date": 1634870770204,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,9 @@\n \r\n from flask import abort, flash, redirect, render_template, url_for\r\n from flask_login import current_user, login_required\r\n \r\n-\r\n+# imports local\r\n from . import admin\r\n from forms import DepartmentForm, EmployeeAssignForm, RoleForm\r\n from .. import db\r\n from ..models import Department, Employee, Role\r\n"
                },
                {
                    "date": 1634870882623,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -8,17 +8,19 @@\n from forms import DepartmentForm, EmployeeAssignForm, RoleForm\r\n from .. import db\r\n from ..models import Department, Employee, Role\r\n \r\n+\r\n def check_admin():\r\n     \"\"\"\r\n     Prevent non-admins from accessing the page\r\n     \"\"\"\r\n     if not current_user.is_admin:\r\n         abort(403)\r\n \r\n+\r\n+\r\n # Department Views\r\n-\r\n @admin.route('/departments', methods=['GET', 'POST'])\r\n @login_required\r\n def list_departments():\r\n     \"\"\"\r\n@@ -30,8 +32,9 @@\n \r\n     return render_template('admin/departments/departments.html',\r\n                            departments=departments, title=\"Departments\")\r\n \r\n+\r\n @admin.route('/departments/add', methods=['GET', 'POST'])\r\n @login_required\r\n def add_department():\r\n     \"\"\"\r\n@@ -61,8 +64,9 @@\n     return render_template('admin/departments/department.html', action=\"Add\",\r\n                            add_department=add_department, form=form,\r\n                            title=\"Add Department\")\r\n \r\n+\r\n @admin.route('/departments/edit/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n def edit_department(id):\r\n     \"\"\"\r\n@@ -88,8 +92,9 @@\n     return render_template('admin/departments/department.html', action=\"Edit\",\r\n                            add_department=add_department, form=form,\r\n                            department=department, title=\"Edit Department\")\r\n \r\n+\r\n @admin.route('/departments/delete/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n def delete_department(id):\r\n     \"\"\"\r\n@@ -104,5 +109,95 @@\n \r\n     # redirect to the departments page\r\n     return redirect(url_for('admin.list_departments'))\r\n \r\n-    return render_template(title=\"Delete Department\")\n\\ No newline at end of file\n+    return render_template(title=\"Delete Department\")\r\n+\r\n+\r\n+# Role Views\r\n+\r\n+@admin.route('/roles')\r\n+@login_required\r\n+def list_roles():\r\n+    check_admin()\r\n+    \"\"\"\r\n+    List all roles\r\n+    \"\"\"\r\n+    roles = Role.query.all()\r\n+    return render_template('admin/roles/roles.html',\r\n+                           roles=roles, title='Roles')\r\n+\r\n+@admin.route('/roles/add', methods=['GET', 'POST'])\r\n+@login_required\r\n+def add_role():\r\n+    \"\"\"\r\n+    Add a role to the database\r\n+    \"\"\"\r\n+    check_admin()\r\n+\r\n+    add_role = True\r\n+\r\n+    form = RoleForm()\r\n+    if form.validate_on_submit():\r\n+        role = Role(name=form.name.data,\r\n+                    description=form.description.data)\r\n+\r\n+        try:\r\n+            # add role to the database\r\n+            db.session.add(role)\r\n+            db.session.commit()\r\n+            flash('You have successfully added a new role.')\r\n+        except:\r\n+            # in case role name already exists\r\n+            flash('Error: role name already exists.')\r\n+\r\n+        # redirect to the roles page\r\n+        return redirect(url_for('admin.list_roles'))\r\n+\r\n+    # load role template\r\n+    return render_template('admin/roles/role.html', add_role=add_role,\r\n+                           form=form, title='Add Role')\r\n+\r\n+@admin.route('/roles/edit/<int:id>', methods=['GET', 'POST'])\r\n+@login_required\r\n+def edit_role(id):\r\n+    \"\"\"\r\n+    Edit a role\r\n+    \"\"\"\r\n+    check_admin()\r\n+\r\n+    add_role = False\r\n+\r\n+    role = Role.query.get_or_404(id)\r\n+    form = RoleForm(obj=role)\r\n+    if form.validate_on_submit():\r\n+        role.name = form.name.data\r\n+        role.description = form.description.data\r\n+        db.session.add(role)\r\n+        db.session.commit()\r\n+        flash('You have successfully edited the role.')\r\n+\r\n+        # redirect to the roles page\r\n+        return redirect(url_for('admin.list_roles'))\r\n+\r\n+    form.description.data = role.description\r\n+    form.name.data = role.name\r\n+    return render_template('admin/roles/role.html', add_role=add_role,\r\n+                           form=form, title=\"Edit Role\")\r\n+\r\n+@admin.route('/roles/delete/<int:id>', methods=['GET', 'POST'])\r\n+@login_required\r\n+def delete_role(id):\r\n+    \"\"\"\r\n+    Delete a role from the database\r\n+    \"\"\"\r\n+    check_admin()\r\n+\r\n+    role = Role.query.get_or_404(id)\r\n+    db.session.delete(role)\r\n+    db.session.commit()\r\n+    flash('You have successfully deleted the role.')\r\n+\r\n+    # redirect to the roles page\r\n+    return redirect(url_for('admin.list_roles'))\r\n+\r\n+    return render_template(title=\"Delete Role\")\n\\ No newline at end of file\n"
                },
                {
                    "date": 1634870906591,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -199,5 +199,49 @@\n \r\n     # redirect to the roles page\r\n     return redirect(url_for('admin.list_roles'))\r\n \r\n-    return render_template(title=\"Delete Role\")\n\\ No newline at end of file\n+    return render_template(title=\"Delete Role\")\r\n+\r\n+\r\n+# Employee Views\r\n+\r\n+@admin.route('/employees')\r\n+@login_required\r\n+def list_employees():\r\n+    \"\"\"\r\n+    List all employees\r\n+    \"\"\"\r\n+    check_admin()\r\n+\r\n+    employees = Employee.query.all()\r\n+    return render_template('admin/employees/employees.html',\r\n+                           employees=employees, title='Employees')\r\n+\r\n+@admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n+@login_required\r\n+def assign_employee(id):\r\n+    \"\"\"\r\n+    Assign a department and a role to an employee\r\n+    \"\"\"\r\n+    check_admin()\r\n+\r\n+    employee = Employee.query.get_or_404(id)\r\n+\r\n+    # prevent admin from being assigned a department or role\r\n+    if employee.is_admin:\r\n+        abort(403)\r\n+\r\n+    form = EmployeeAssignForm(obj=employee)\r\n+    if form.validate_on_submit():\r\n+        employee.department = form.department.data\r\n+        employee.role = form.role.data\r\n+        db.session.add(employee)\r\n+        db.session.commit()\r\n+        flash('You have successfully assigned a department and role.')\r\n+\r\n+        # redirect to the roles page\r\n+        return redirect(url_for('admin.list_employees'))\r\n+\r\n+    return render_template('admin/employees/employee.html',\r\n+                           employee=employee, form=form,\r\n+                           title='Assign Employee')\n\\ No newline at end of file\n"
                },
                {
                    "date": 1634875301170,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n def list_departments():\r\n     \"\"\"\r\n     List all departments\r\n     \"\"\"\r\n-    check_admin()\r\n+    #check_admin()\r\n \r\n     departments = Department.query.all()\r\n \r\n     return render_template('admin/departments/departments.html',\r\n@@ -39,9 +39,9 @@\n def add_department():\r\n     \"\"\"\r\n     Add a department to the database\r\n     \"\"\"\r\n-    check_admin()\r\n+    #check_admin()\r\n \r\n     add_department = True\r\n \r\n     form = DepartmentForm()\r\n@@ -71,9 +71,9 @@\n def edit_department(id):\r\n     \"\"\"\r\n     Edit a department\r\n     \"\"\"\r\n-    check_admin()\r\n+    #check_admin()\r\n \r\n     add_department = False\r\n \r\n     department = Department.query.get_or_404(id)\r\n@@ -99,9 +99,9 @@\n def delete_department(id):\r\n     \"\"\"\r\n     Delete a department from the database\r\n     \"\"\"\r\n-    check_admin()\r\n+    #check_admin()\r\n \r\n     department = Department.query.get_or_404(id)\r\n     db.session.delete(department)\r\n     db.session.commit()\r\n@@ -117,9 +117,9 @@\n \r\n @admin.route('/roles')\r\n @login_required\r\n def list_roles():\r\n-    check_admin()\r\n+    #check_admin()\r\n     \"\"\"\r\n     List all roles\r\n     \"\"\"\r\n     roles = Role.query.all()\r\n@@ -162,9 +162,9 @@\n def edit_role(id):\r\n     \"\"\"\r\n     Edit a role\r\n     \"\"\"\r\n-    check_admin()\r\n+    #check_admin()\r\n \r\n     add_role = False\r\n \r\n     role = Role.query.get_or_404(id)\r\n@@ -189,9 +189,9 @@\n def delete_role(id):\r\n     \"\"\"\r\n     Delete a role from the database\r\n     \"\"\"\r\n-    check_admin()\r\n+    #check_admin()\r\n \r\n     role = Role.query.get_or_404(id)\r\n     db.session.delete(role)\r\n     db.session.commit()\r\n@@ -210,12 +210,12 @@\n def list_employees():\r\n     \"\"\"\r\n     List all employees\r\n     \"\"\"\r\n-    check_admin()\r\n+    #check_admin()\r\n \r\n     employees = Employee.query.all()\r\n-    return render_template('admin/employees/employees.html',\r\n+    return render_template('home/superadmin',\r\n                            employees=employees, title='Employees')\r\n \r\n @admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n"
                },
                {
                    "date": 1634875351412,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,9 +213,9 @@\n     \"\"\"\r\n     #check_admin()\r\n \r\n     employees = Employee.query.all()\r\n-    return render_template('home/superadmin',\r\n+    return render_template('home/dashboard.html',\r\n                            employees=employees, title='Employees')\r\n \r\n @admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n"
                },
                {
                    "date": 1634875367112,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,9 +213,9 @@\n     \"\"\"\r\n     #check_admin()\r\n \r\n     employees = Employee.query.all()\r\n-    return render_template('home/dashboard.html',\r\n+    return render_template('home/superadmin_dashboard.html',\r\n                            employees=employees, title='Employees')\r\n \r\n @admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n"
                },
                {
                    "date": 1634875545788,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n def list_departments():\r\n     \"\"\"\r\n     List all departments\r\n     \"\"\"\r\n-    #check_admin()\r\n+    check_admin()\r\n \r\n     departments = Department.query.all()\r\n \r\n     return render_template('admin/departments/departments.html',\r\n@@ -39,9 +39,9 @@\n def add_department():\r\n     \"\"\"\r\n     Add a department to the database\r\n     \"\"\"\r\n-    #check_admin()\r\n+    check_admin()\r\n \r\n     add_department = True\r\n \r\n     form = DepartmentForm()\r\n@@ -71,9 +71,9 @@\n def edit_department(id):\r\n     \"\"\"\r\n     Edit a department\r\n     \"\"\"\r\n-    #check_admin()\r\n+    check_admin()\r\n \r\n     add_department = False\r\n \r\n     department = Department.query.get_or_404(id)\r\n@@ -99,9 +99,9 @@\n def delete_department(id):\r\n     \"\"\"\r\n     Delete a department from the database\r\n     \"\"\"\r\n-    #check_admin()\r\n+    check_admin()\r\n \r\n     department = Department.query.get_or_404(id)\r\n     db.session.delete(department)\r\n     db.session.commit()\r\n@@ -117,9 +117,9 @@\n \r\n @admin.route('/roles')\r\n @login_required\r\n def list_roles():\r\n-    #check_admin()\r\n+    check_admin()\r\n     \"\"\"\r\n     List all roles\r\n     \"\"\"\r\n     roles = Role.query.all()\r\n@@ -162,9 +162,9 @@\n def edit_role(id):\r\n     \"\"\"\r\n     Edit a role\r\n     \"\"\"\r\n-    #check_admin()\r\n+    check_admin()\r\n \r\n     add_role = False\r\n \r\n     role = Role.query.get_or_404(id)\r\n@@ -189,9 +189,9 @@\n def delete_role(id):\r\n     \"\"\"\r\n     Delete a role from the database\r\n     \"\"\"\r\n-    #check_admin()\r\n+    check_admin()\r\n \r\n     role = Role.query.get_or_404(id)\r\n     db.session.delete(role)\r\n     db.session.commit()\r\n@@ -210,12 +210,12 @@\n def list_employees():\r\n     \"\"\"\r\n     List all employees\r\n     \"\"\"\r\n-    #check_admin()\r\n+    check_admin()\r\n \r\n     employees = Employee.query.all()\r\n-    return render_template('home/superadmin_dashboard.html',\r\n+    return render_template('admin/employees/employees.html',\r\n                            employees=employees, title='Employees')\r\n \r\n @admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n"
                },
                {
                    "date": 1634875633547,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,9 +213,9 @@\n     \"\"\"\r\n     check_admin()\r\n \r\n     employees = Employee.query.all()\r\n-    return render_template('admin/employees/employees.html',\r\n+    return render_template('admin/employees.html',\r\n                            employees=employees, title='Employees')\r\n \r\n @admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n"
                },
                {
                    "date": 1634876004062,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,9 +213,9 @@\n     \"\"\"\r\n     check_admin()\r\n \r\n     employees = Employee.query.all()\r\n-    return render_template('admin/employees.html',\r\n+    return render_template('home/employees.html',\r\n                            employees=employees, title='Employees')\r\n \r\n @admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n"
                },
                {
                    "date": 1634876188724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,9 +213,9 @@\n     \"\"\"\r\n     check_admin()\r\n \r\n     employees = Employee.query.all()\r\n-    return render_template('home/employees.html',\r\n+    return render_template('admin/employees/employees.html',\r\n                            employees=employees, title='Employees')\r\n \r\n @admin.route('/employees/assign/<int:id>', methods=['GET', 'POST'])\r\n @login_required\r\n"
                }
            ],
            "date": 1634868669176,
            "name": "Commit-0",
            "content": "# app/admin/views.py\r\n\r\nfrom flask import abort, flash, redirect, render_template, url_for\r\nfrom flask_login import current_user, login_required\r\n\r\nfrom . import admin\r\nfrom forms import DepartmentForm\r\nfrom .. import db\r\nfrom ..models import Department\r\n\r\ndef check_admin():\r\n    \"\"\"\r\n    Prevent non-admins from accessing the page\r\n    \"\"\"\r\n    if not current_user.is_admin:\r\n        abort(403)\r\n\r\n# Department Views\r\n\r\n@admin.route('/departments', methods=['GET', 'POST'])\r\n@login_required\r\ndef list_departments():\r\n    \"\"\"\r\n    List all departments\r\n    \"\"\"\r\n    check_admin()\r\n\r\n    departments = Department.query.all()\r\n\r\n    return render_template('admin/departments/departments.html',\r\n                           departments=departments, title=\"Departments\")\r\n\r\n@admin.route('/departments/add', methods=['GET', 'POST'])\r\n@login_required\r\ndef add_department():\r\n    \"\"\"\r\n    Add a department to the database\r\n    \"\"\"\r\n    check_admin()\r\n\r\n    add_department = True\r\n\r\n    form = DepartmentForm()\r\n    if form.validate_on_submit():\r\n        department = Department(name=form.name.data,\r\n                                description=form.description.data)\r\n        try:\r\n            # add department to the database\r\n            db.session.add(department)\r\n            db.session.commit()\r\n            flash('You have successfully added a new department.')\r\n        except:\r\n            # in case department name already exists\r\n            flash('Error: department name already exists.')\r\n\r\n        # redirect to departments page\r\n        return redirect(url_for('admin.list_departments'))\r\n\r\n    # load department template\r\n    return render_template('admin/departments/department.html', action=\"Add\",\r\n                           add_department=add_department, form=form,\r\n                           title=\"Add Department\")\r\n\r\n@admin.route('/departments/edit/<int:id>', methods=['GET', 'POST'])\r\n@login_required\r\ndef edit_department(id):\r\n    \"\"\"\r\n    Edit a department\r\n    \"\"\"\r\n    check_admin()\r\n\r\n    add_department = False\r\n\r\n    department = Department.query.get_or_404(id)\r\n    form = DepartmentForm(obj=department)\r\n    if form.validate_on_submit():\r\n        department.name = form.name.data\r\n        department.description = form.description.data\r\n        db.session.commit()\r\n        flash('You have successfully edited the department.')\r\n\r\n        # redirect to the departments page\r\n        return redirect(url_for('admin.list_departments'))\r\n\r\n    form.description.data = department.description\r\n    form.name.data = department.name\r\n    return render_template('admin/departments/department.html', action=\"Edit\",\r\n                           add_department=add_department, form=form,\r\n                           department=department, title=\"Edit Department\")\r\n\r\n@admin.route('/departments/delete/<int:id>', methods=['GET', 'POST'])\r\n@login_required\r\ndef delete_department(id):\r\n    \"\"\"\r\n    Delete a department from the database\r\n    \"\"\"\r\n    check_admin()\r\n\r\n    department = Department.query.get_or_404(id)\r\n    db.session.delete(department)\r\n    db.session.commit()\r\n    flash('You have successfully deleted the department.')\r\n\r\n    # redirect to the departments page\r\n    return redirect(url_for('admin.list_departments'))\r\n\r\n    return render_template(title=\"Delete Department\")"
        }
    ]
}